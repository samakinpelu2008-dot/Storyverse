<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StoryVerse</title>

<style>
/* GENERAL */
body { margin:0; font-family:Arial; background:#f2f2f7; }
.hidden { display:none; }

/* HEADER */
#header {
    background:#4B0082; color:white;
    padding:15px; text-align:center;
    position:fixed; top:0; width:100%; z-index:10;
}
#searchBar {
    width:90%; padding:10px; border-radius:6px;
    border:none; margin-top:10px;
}

/* CONTENT */
.page { padding-top:120px; padding-bottom:100px; }

/* STORY GRID */
.story-grid {
    display:grid; gap:20px;
    grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
    padding:20px;
}
.story-card {
    background:white; border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    overflow:hidden; cursor:pointer;
}
.story-card img { width:100%; height:150px; object-fit:cover; }
.story-card h3 { margin:10px; font-size:18px; }
.story-card p { margin:10px; color:#555; }

/* EPISODE LIST */
.episode-item {
    background:white; padding:15px;
    margin:10px; border-radius:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    cursor:pointer;
}

/* EPISODE READER */
#episode-content {
    background:white; padding:20px;
    margin:15px; border-radius:10px;
    line-height:1.7;
}
.nav-buttons button {
    padding:10px; border:none;
    background:#4B0082; color:white;
    border-radius:6px; margin:5px;
}

/* NOTIFICATIONS */
.notification {
    background:white; padding:15px;
    margin:15px; border-radius:8px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

/* ADMIN PANEL */
#adminPanel input, #adminPanel textarea, #adminPanel select, #adminPanel button {
    width:100%; padding:10px; margin:8px 0;
    border-radius:5px; border:1px solid #ccc;
}
#episode-list li { font-size:14px; margin:5px 0; }

/* BOTTOM NAV */
#bottom-nav {
    position:fixed; bottom:0; width:100%;
    background:#4B0082; color:white;
    display:flex; justify-content:space-around;
    padding:10px 0; z-index:20;
}
.nav-item { text-align:center; position:relative; cursor:pointer; }
.red-dot {
    width:10px; height:10px; background:red;
    border-radius:50%; position:absolute;
    top:0; right:25px; display:none;
}

/* FOOTER COPYRIGHT */
#copyright {
    text-align:center; color:#4B0082;
    padding:10px; font-weight:bold;
}
</style>
</head>
<body>

<!-- HEADER -->
<div id="header">
    <h1>StoryVerse</h1>
    <input id="searchBar" placeholder="Search stories..." oninput="searchStories()">
</div>

<!-- HOME PAGE -->
<div id="homePage" class="page">
    <div class="story-grid" id="storyGrid"></div>
</div>

<!-- STORY PAGE -->
<div id="storyPage" class="page hidden">
    <h2 id="storyTitle" style="text-align:center;"></h2>
    <div id="episodeList"></div>
</div>

<!-- EPISODE READER PAGE -->
<div id="episodePage" class="page hidden">
    <h2 id="episodeTitle" style="text-align:center;"></h2>
    <div id="episode-content"></div>
    <div class="nav-buttons" style="text-align:center;">
        <button onclick="prevEpisode()">Previous</button>
        <button onclick="nextEpisode()">Next</button>
    </div>
</div>

<!-- NOTIFICATIONS PAGE -->
<div id="notifPage" class="page hidden">
    <h2 style="text-align:center;">Notifications</h2>
    <div id="notifList"></div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPage" class="page hidden">
    <h2 style="text-align:center;">Admin Panel</h2>

    <input id="newTitle" placeholder="Story Pack Title">
    <input id="newWriter" placeholder="Writer Name">

    <select id="newSection">
        <option value="Horror">Horror</option>
        <option value="Sci-Fi">Sci-Fi</option>
        <option value="Fantasy">Fantasy</option>
        <option value="Romance">Romance</option>
    </select>

    <input id="newImg" placeholder="Image URL">

    <label><input type="checkbox" id="episodicToggle"> Episodic Story (Multiple Episodes)</label>

    <div id="episodeInputs" class="hidden">
        <textarea id="epContent" placeholder="Episode Content"></textarea>
        <input id="epNumber" type="number" placeholder="Episode Number">
        <button onclick="addEpisodeToPack()">Add Episode</button>

        <ul id="episode-list"></ul>
    </div>

    <button onclick="publishStory()">Publish Story Pack</button>

    <hr>

    <h3>Add Notification</h3>
    <input id="notifInput" placeholder="Notification text">
    <button onclick="addNotification()">Publish Notification</button>

    <div id="copyright">StoryVerse ¬©</div>
</div>

<!-- BOTTOM NAVIGATION -->
<div id="bottom-nav">
    <div class="nav-item" onclick="showPage('homePage')">üè†<br>Home</div>
    <div class="nav-item" onclick="showPage('notifPage')">
        üîî<br>Notifications
        <div id="notifDot" class="red-dot"></div>
    </div>
    <div class="nav-item" onclick="showPage('adminPage')">‚öôÔ∏è<br>Admin</div>
</div>

<script>
/* ==============================
   DATA STORAGE
============================== */
let stories = [];
let notifications = [];
let newEpisodes = [];

let currentStory = null;
let currentEpisodeIndex = 0;

/* ==============================
   PAGE SWITCHING
============================== */
function showPage(page) {
    document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
    document.getElementById(page).classList.remove('hidden');
    if(page === "notifPage") document.getElementById('notifDot').style.display = "none";
}

/* ==============================
   HOME PAGE ‚Äì DISPLAY STORIES
============================== */
function renderStories() {
    const grid = document.getElementById("storyGrid");
    grid.innerHTML = "";

    // Sort by popularity
    const sorted = [...stories].sort((a,b) => (b.views+b.likes) - (a.views+a.likes));

    sorted.forEach((story, i) => {
        grid.innerHTML += `
            <div class="story-card" onclick="openStory(${i})">
                <img src="${story.img}">
                <h3>${story.title}</h3>
                <p>By ${story.writer}</p>
                <p>${story.episodes.length} Episodes</p>
            </div>
        `;
    });
}

/* ==============================
   SEARCH
============================== */
function searchStories() {
    const text = document.getElementById("searchBar").value.toLowerCase();
    document.getElementById("storyGrid").innerHTML = "";

    stories.filter(s => s.title.toLowerCase().includes(text))
    .forEach((story, i) => {
        document.getElementById("storyGrid").innerHTML += `
            <div class="story-card" onclick="openStory(${i})">
                <img src="${story.img}">
                <h3>${story.title}</h3>
                <p>By ${story.writer}</p>
                <p>${story.episodes.length} Episodes</p>
            </div>
        `;
    });
}

/* ==============================
   OPEN STORY & EPISODES
============================== */
function openStory(index) {
    currentStory = stories[index];
    showPage("storyPage");

    document.getElementById("storyTitle").innerText = currentStory.title;

    const epList = document.getElementById("episodeList");
    epList.innerHTML = "";

    currentStory.episodes.sort((a,b)=>a.number-b.number);

    currentStory.episodes.forEach((ep, i) => {
        epList.innerHTML += `
            <div class="episode-item" onclick="openEpisode(${i})">
                Episode ${ep.number}
            </div>
        `;
    });
}

/* ==============================
   OPEN EPISODE READER
============================== */
function openEpisode(i) {
    currentEpisodeIndex = i;
    showPage("episodePage");

    const ep = currentStory.episodes[i];

    document.getElementById("episodeTitle").innerText =
        `${currentStory.title} ‚Äì Episode ${ep.number}`;

    document.getElementById("episode-content").innerText = ep.content;
}

/* NEXT / PREVIOUS EPISODE */
function nextEpisode() {
    if(currentEpisodeIndex < currentStory.episodes.length - 1)
        openEpisode(currentEpisodeIndex + 1);
}
function prevEpisode() {
    if(currentEpisodeIndex > 0)
        openEpisode(currentEpisodeIndex - 1);
}

/* ==============================
   ADMIN ‚Äì EPISODES
============================== */
document.getElementById("episodicToggle").addEventListener("change", function () {
    document.getElementById("episodeInputs").classList.toggle("hidden", !this.checked);
});

function addEpisodeToPack() {
    const content = document.getElementById("epContent").value;
    const num = document.getElementById("epNumber").value;

    if(!content || !num) return alert("Fill episode fields");

    newEpisodes.push({ number:Number(num), content });

    document.getElementById("episode-list").innerHTML =
        newEpisodes.map(e => `<li>Episode ${e.number}</li>`).join("");

    document.getElementById("epContent").value = "";
    document.getElementById("epNumber").value = "";
}

/* ==============================
   ADMIN ‚Äì PUBLISH STORY
============================== */
function publishStory() {
    const title = document.getElementById("newTitle").value;
    const writer = document.getElementById("newWriter").value;
    const section = document.getElementById("newSection").value;
    const img = document.getElementById("newImg").value;

    const episodic = document.getElementById("episodicToggle").checked;

    if(!title || !writer || !img) return alert("Fill all fields");

    stories.push({
        title, writer, img, section,
        episodes: episodic ? [...newEpisodes] : [{ number:1, content:"One time story" }],
        likes:0, views:0
    });

    newEpisodes = [];
    document.getElementById("episode-list").innerHTML = "";

    alert("Story Published!");
    renderStories();
    showPage("homePage");
}

/* ==============================
   ADMIN ‚Äì NOTIFICATIONS
============================== */
function addNotification() {
    const t = document.getElementById("notifInput").value;
    if(!t) return;

    notifications.push({text:t});
    document.getElementById("notifInput").value = "";

    renderNotifications();
    document.getElementById("notifDot").style.display = "block";
}

/* RENDER NOTIFICATIONS */
function renderNotifications() {
    const list = document.getElementById("notifList");
    list.innerHTML = "";

    notifications.forEach(n => {
        list.innerHTML += `<div class="notification">${n.text}</div>`;
    });
}

/* INITIAL RENDER */
renderStories();
</script>

</body>
</html>
